(()=>{var t,e={2634:()=>{},6948:(t,e,i)=>{"use strict";i(656);var s,n=i(1903);!function(t){t[t.BLACK=0]="BLACK",t[t.WHITE=16777215]="WHITE",t[t.RED=16711680]="RED",t[t.GREEN=65280]="GREEN",t[t.BLUE=255]="BLUE",t[t.YELLOW=16776960]="YELLOW",t[t.GRAY=8421504]="GRAY",t[t.DARK_GRAY=4210752]="DARK_GRAY",t[t.LIGHT_GRAY=12632256]="LIGHT_GRAY",t[t.BACKGROUND=1118481]="BACKGROUND",t[t.DEBUG_GREEN=2293538]="DEBUG_GREEN",t[t.DEBUG_YELLOW=16772608]="DEBUG_YELLOW"}(s||(s={}));class a{constructor(){this.POS_X=10,this.POS_Y=40,this.PADDING=10,this.LINE_HEIGHT=18,this.FONT_SIZE=16,this.container=new n.mcf,this.background=new n.A1g}init(){this.setupBackground(),this.setupTexts(),this.setupLayout()}setupBackground(){this.background.beginFill(0,.7),this.background.lineStyle(1,s.DEBUG_GREEN,1),this.background.drawRoundedRect(0,0,200,3*this.LINE_HEIGHT+2*this.PADDING,5),this.background.endFill(),this.container.addChild(this.background)}setupTexts(){this.fpsText=new n.T7$("FPS: 0",{fontName:"MonospaceBold",fontSize:this.FONT_SIZE}),this.spriteText=new n.T7$("Sprites: 0",{fontName:"MonospaceBold",fontSize:this.FONT_SIZE}),this.fpsText.tint=s.DEBUG_GREEN,this.spriteText.tint=s.DEBUG_YELLOW,this.container.addChild(this.fpsText),this.container.addChild(this.spriteText)}setupLayout(){this.container.position.set(this.POS_X,this.POS_Y),this.fpsText.position.set(this.PADDING,this.PADDING),this.spriteText.position.set(this.PADDING,this.PADDING+2*this.LINE_HEIGHT)}updateDebugInfo(t){this.fpsText.text=`FPS: ${t.fps.toString()}`,this.spriteText.text=`Sprites: ${t.spriteCount.toString()}`,t.fps>=55?this.fpsText.tint=s.DEBUG_GREEN:t.fps>=30?this.fpsText.tint=s.DEBUG_YELLOW:this.fpsText.tint=s.RED}setVisible(t){this.container.visible=t}}class o{constructor(){this.screenWidth=0,this.screenHeight=0,this.initialized=!1,this.container=new n.mcf}resize(t,e){this.screenWidth=t,this.screenHeight=e,this.initialized&&this.onResize(t,e)}onResize(t,e){}destroy(){this.container.removeChildren(),this.container.destroy({children:!0,texture:!1,baseTexture:!1}),this.initialized=!1}centerObject(t){t.x=this.screenWidth/2,t.y=this.screenHeight/2,t.anchor.set(.5)}}class r{async loadInitialAssets(){const t=await n.sP.load("assets/images/fish_blue.png");r.textureCache.set("demo_sprite",t),await r.loadFont("MonospaceBold","./assets/fonts/MonospaceBold.fnt","./assets/fonts/MonospaceBold.png"),await r.loadAtlas("playingCards","./assets/images/playingCards.json"),await r.loadAtlas("fireParticles","./assets/images/fireParticles.json"),await r.loadAtlas("fireMetaBalls","./assets/images/fireMetaBalls.json"),await r.loadMagicWordsAssets()}static getTexture(t){const e=r.textureCache.get(t)??n.sP.cache.get(t);if(!e)throw new Error(`Texture '${t}' not found. Make sure it's loaded first.`);return e}static hasTexture(t){return r.textureCache.has(t)||n.sP.cache.has(t)}static async loadFont(t,e,i){try{await n.sP.load([{alias:`${t}_texture`,src:i},{alias:t,src:e}])}catch(e){throw console.error(`Failed to load bitmap font ${t}:`,e),e}}static async loadAtlas(t,e){try{await n.sP.load({alias:t,src:e})}catch(e){throw console.error(`Failed to load texture atlas ${t}:`,e),e}}static async loadEmojis(t){const e=new Map,i=t.map(async t=>{try{const i=await n.sP.load({src:t.url,loadParser:"loadTextures"});e.set(t.name,i),r.textureCache.set(`emoji_${t.name}`,i)}catch(e){console.error(`Failed to load emoji texture for ${t.name} from ${t.url}:`,e)}});return await Promise.all(i),e}static async loadAvatars(t){const e=new Map,i=await n.sP.load("assets/images/default_avatar.png");r.textureCache.set("default_avatar",i);const s=t.map(async t=>{try{const i=await n.sP.load({src:t.url,loadParser:"loadTextures"});e.set(t.name,{position:t.position,texture:i}),r.textureCache.set(`avatar_${t.name}`,i)}catch(e){console.error(`Failed to load avatar texture for ${t.name} from ${t.url}:`,e)}});return await Promise.all(s),e}static getEmojiTexture(t){return r.textureCache.get(`emoji_${t}`)??n.sP.cache.get(`emoji_${t}`)}static getAvatarTexture(t){return r.textureCache.get(`avatar_${t}`)??n.sP.cache.get(`avatar_${t}`)}static async loadMagicWordsAssets(){try{const t=await fetch("https://private-624120-softgamesassignment.apiary-mock.com/v2/magicwords");if(!t.ok)throw new Error(`Failed to fetch Magic Words data: ${t.status.toString()}`);const e=await t.json();if(0===e.dialogue.length)throw new Error("No dialogue data found in API response");r.magicWordsData=e,await r.loadEmojis(r.magicWordsData.emojies),r.avatarTextures=await r.loadAvatars(r.magicWordsData.avatars)}catch(t){throw console.error("Failed to load Magic Words assets:",t),t}}static getMagicWordsData(){return r.magicWordsData}static getAllEmojiTextures(){const t=new Map;for(const[e,i]of r.textureCache.entries())e.startsWith("emoji_")&&t.set(e.substring(6),i);return t}static getAllAvatarTextures(){if(r.avatarTextures)return r.avatarTextures;{const t=new Map;for(const[e,i]of r.textureCache.entries())e.startsWith("avatar_")&&t.set(e.substring(7),{texture:i,position:"left"});return t}}}r.textureCache=new Map,r.magicWordsData=null,r.avatarTextures=null;class h{constructor(t,e){this.id=h.nextId++,this.x=t,this.y=e,this.active=!0,this.merged=!1;const i=(270+30*(Math.random()-.5))*Math.PI/180,s=50+50*Math.random();this.vx=Math.cos(i)*s,this.vy=Math.sin(i)*s,this.maxLife=2+2*Math.random(),this.life=this.maxLife}update(t){this.active&&(this.x+=this.vx*t,this.y+=this.vy*t,this.vy-=20*t,this.vx+=10*(Math.random()-.5)*t,this.vy+=5*(Math.random()-.5)*t,this.vx*=.995,this.vy*=.995,this.life-=t,this.life<=0&&(this.active=!1))}getAlpha(){if(!this.active)return 0;const t=2*this.life;return t<1?t:1}}h.nextId=1;class c extends n.mcf{constructor(t){super(),this.particles=[],this.singleSprites=new Map,this.groups=new Map,this.maxSprites=t.max,this.emitterWidth=t.width,this.emitterHeight=t.height,this.baseMergeDistance=t.mergeDistance??5,this.spawnInterval=t.spawnInterval??.15,this.spawnTimer=0}update(t){this.spawnTimer+=t;for(const e of this.particles)e.update(t);this.cullDeadParticles();const e=this.clusterToFitBudget();this.reconcileVisuals(e),this.maybeSpawn(),this.updateSingleSprites(),this.updateGroupSprites()}scaleAtY(t){return.12+2*Math.max(0,Math.min(1,t/this.emitterHeight))}maybeSpawn(){if(this.spawnTimer<this.spawnInterval)return;const t=this.getVisualSpriteCount();t<this.maxSprites&&(this.spawnInterval=t>this.maxSprites-3?.25:.15,this.spawnOne()),this.spawnTimer=0}spawnOne(){const t=Math.random()*Math.PI*2,e=30*Math.random(),i=this.emitterWidth/2+Math.cos(t)*e,s=.5*Math.random(),a=s*s*15,o=this.emitterHeight-10-a+Math.sin(t)*e*.3,c=new h(i,o);this.particles.push(c);const l=["xs","s","m","l","xl","xxl"],d=l[Math.floor(Math.random()*l.length)],u=1+Math.floor(6*Math.random()),p=r.getTexture(`single_${d}_${u}`),g=new n.kxk(p);g.anchor.set(.5),g.x=c.x,g.y=c.y,g.rotation=Math.random()*Math.PI*2,this.singleSprites.set(c,g),this.addChild(g)}getVisualSpriteCount(){let t=0;for(const e of this.particles)e.active&&(t+=1);return t+this.groups.size}cullDeadParticles(){for(let t=this.particles.length-1;t>=0;t--){const e=this.particles[t];if(!e||e.active)continue;const i=this.singleSprites.get(e);i&&i.parent&&this.removeChild(i),this.singleSprites.delete(e),this.particles.splice(t,1)}}clusterToFitBudget(){const t=this.particles.filter(t=>t.active);if(0===t.length)return[];const e=[1,1.12,1.4,1.8,2,2.2];let i=[];for(const s of e){const e=this.clusterParticles(t,this.baseMergeDistance*s);if(i=e,e.length<=this.maxSprites)break}return i}pickAnchor(t){let e=t[0],i=-1/0;for(const s of t){const t=.65*Math.max(0,Math.min(1,s.y/this.emitterHeight))+.35*s.getAlpha();t>i&&(i=t,e=s)}return e}clusterParticles(t,e){const i=e,s=(t,e)=>`${Math.floor(t/i)},${Math.floor(e/i)}`,n=new Map;for(const e of t){const t=s(e.x,e.y),i=n.get(t);void 0===i?n.set(t,[e]):i.push(e)}const a=new Set,o=[],r=(t,e)=>{const s=Math.floor(t/i),a=Math.floor(e/i),o=[];for(let t=-1;t<=1;t++)for(let e=-1;e<=1;e++){const i=n.get(`${s+e},${a+t}`);void 0!==i&&o.push(...i)}return o};for(const i of t){if(a.has(i.id))continue;let t=i.x,s=i.y,n=1,h=i.x,c=i.y;const l=[i];a.add(i.id);const d=[i],u=1;for(;d.length>0;){const i=d.pop();for(const o of r(i.x,i.y)){if(a.has(o.id)||o.id===i.id)continue;const r=i.x-o.x,p=i.y-o.y,g=r*r+p*p,m=e*Math.max(this.scaleAtY(i.y),this.scaleAtY(o.y));if(g>m*m)continue;const f=e*u*this.scaleAtY(c)*(1+c/this.emitterHeight*.8),x=o.x-h,_=o.y-c;x*x+_*_>f*f||(a.add(o.id),l.push(o),t+=o.x,s+=o.y,n+=1,h=t/n,c=s/n,d.push(o))}}o.push(l)}return o}reconcileVisuals(t){for(const t of this.particles)t.merged=!1;const e=new Map;for(const i of t){if(i.length<=1)continue;const t=this.keyFor(i);let s=this.groups.get(t);const a=this.pickAnchor(i);if(void 0===s){const e=this.pickMergeTexture(i),o=new n.kxk(r.getTexture(e));o.anchor.set(.5),o.x=a.x,o.y=a.y,s={key:t,particles:i,sprite:o,anchor:a},this.addChild(o)}else s.particles=i,s.anchor=a;for(const t of i){t.merged=!0;const e=this.singleSprites.get(t);void 0!==e&&(e.visible=!1)}e.set(t,s)}for(const[t,i]of this.groups)!e.has(t)&&i.sprite.parent&&this.removeChild(i.sprite);this.groups=e;for(const t of this.particles){if(!t.active)continue;const e=this.singleSprites.get(t);void 0!==e&&(e.visible=!t.merged)}}keyFor(t){return t.map(t=>t.id).sort((t,e)=>t-e).join(",")}updateSingleSprites(){for(const[t,e]of this.singleSprites){if(!t.active||t.merged)continue;e.x=t.x,e.y=t.y,e.alpha=t.getAlpha(),e.blendMode=1;const i=(1-t.life/t.maxLife)**2,s=Math.max(.1,4-3.8*i),n=.3+t.y/this.emitterHeight*.7;e.scale.set(s*n,s)}}updateGroupSprites(){for(const t of this.groups.values()){let e=t.anchor;e.active||(e=this.pickAnchor(t.particles),t.anchor=e);let i=0,s=0;for(const e of t.particles)e.active&&(i+=e.getAlpha(),s+=1);if(0===s){t.sprite.parent&&this.removeChild(t.sprite);continue}t.sprite.x=e.x,t.sprite.y=e.y,t.sprite.alpha=i/s,t.sprite.blendMode=1;const n=Math.max(0,(this.emitterHeight-e.y)/this.emitterHeight),a=Math.max(.2,4.2-4*n),o=.3+e.y/this.emitterHeight*.7;t.sprite.scale.set(a*o,a)}}pickMergeTexture(t){const e=t.length,i=()=>{const t=["xs","s","m","l","xl","xxl"];return`single_${t[Math.floor(Math.random()*t.length)]}_${1+Math.floor(6*Math.random())}`};if(2===e){const e=t[0],s=t[1];if(void 0===e||void 0===s)return i();const n=Math.abs(e.x-s.x),a=Math.abs(e.y-s.y),o=Math.sqrt(n*n+a*a);let r;if(n>1.8*a)r=o<15?"h2_close":o<30?"h2_mid":"h2_far";else if(a>1.8*n)r=o<15?"v2_close":o<30?"v2_mid":"v2_far";else{const t=(180*Math.atan2(s.y-e.y,s.x-e.x)/Math.PI+360)%360;r=t>=315||t<45?Math.random()<.7?"a2_30":"a2_150":t>=45&&t<135?Math.random()<.5?"d2_ne":"d2_se":t>=135&&t<225?Math.random()<.7?"a2_60":"a2_120":Math.random()<.5?"d2_nw":"d2_sw",o<8?r=Math.random()<.6?"o2_heavy":"o2_slight":o<12&&(r=Math.random()<.3?"o2_slight":r)}return`merge_${r}_${1+Math.floor(4*Math.random())}`}if(3===e){const t=["tri3_eq","tri3_iso","tri3_right","tri3_acute","lin3_h_close","lin3_h_far","lin3_v_close","lin3_v_far","lin3_diag","lin3_antidiag","l3_ne","l3_nw","l3_se","l3_sw","arc3_top","arc3_bottom","arc3_left","arc3_right","v3_up","v3_down","v3_left","v3_right"];return`merge_${t[Math.floor(Math.random()*t.length)]}_${1+Math.floor(4*Math.random())}`}if(4===e){const t=["cross4","plus4","cross4_diag","square4","rect4_h","rect4_v","diamond4","line4_h","line4_v","line4_diag","t4_up","t4_down","t4_left","t4_right"];return`merge_${t[Math.floor(Math.random()*t.length)]}_${1+Math.floor(4*Math.random())}`}if(5===e){const t=["cluster5","star5","x5"];return`merge_${t[Math.floor(Math.random()*t.length)]}_${1+Math.floor(4*Math.random())}`}if(6===e){const t=["hex6","flower6","grid6"];return`merge_${t[Math.floor(Math.random()*t.length)]}_${1+Math.floor(4*Math.random())}`}if(e>=7){const t=["circle7","burst8"];return`merge_${t[Math.floor(Math.random()*t.length)]}_${1+Math.floor(4*Math.random())}`}if(Math.random()<.3){const t=["scatter3","scatter4","scatter5","scatter6","scatter7","scatter8","scatter9","scatter10"];return`${t[Math.floor(Math.random()*t.length)]}_${1+Math.floor(5*Math.random())}`}if(Math.random()<.2){const t=["tear_up","tear_down","tear_left","tear_right","comet_ne","comet_nw","comet_se","comet_sw","flame_tall","flame_wide","flame_left","flame_right","wave_h","wave_v","wave_s"];return`asym_${t[Math.floor(Math.random()*t.length)]}_${1+Math.floor(3*Math.random())}`}return i()}destroy(){for(const t of this.singleSprites.values())t.parent&&t.parent.removeChild(t);this.singleSprites.clear();for(const t of this.groups.values())t.sprite.parent&&t.sprite.parent.removeChild(t.sprite);this.groups.clear(),this.particles.length=0,super.destroy()}}class l extends o{constructor(){super(),this.name="PhoenixFlame",this.animationTime=0,this.titleText=new n.T7$("Phoenix Flame",{fontName:"MonospaceBold",fontSize:28})}init(){this.setupFire(),this.setupTexts(),this.initialized=!0}setupTexts(){this.titleText.tint=s.WHITE,this.titleText.anchor.set(.5,0),this.titleText.x=this.screenWidth/2,this.titleText.y=40,this.container.addChild(this.titleText)}setupFire(){this.fireMetaBallSystem=new c({max:10,width:400,height:400}),this.fireMetaBallSystem.pivot.set(200,0),this.container.addChild(this.fireMetaBallSystem)}update(t){this.animationTime+=.02*t,this.fireMetaBallSystem.update(t/1e3)}onResize(t,e){this.titleText.x=t/2,this.fireMetaBallSystem.x=t/2}}var d=i(40);class u extends n.kxk{constructor(t){const e=(t-1)%u.AVAILABLE_CARDS.length,i=u.AVAILABLE_CARDS[e]??"red_joker";super(r.getTexture(i)),this.currentStackIndex=0,this.positionInStack=0,this.cardNumber=t,this.anchor.set(.5),this.scale.set(.15)}setStackPosition(t,e){this.currentStackIndex=t,this.positionInStack=e}}u.AVAILABLE_CARDS=["ace_of_spades2","2_of_spades","3_of_spades","4_of_spades","5_of_spades","6_of_spades","7_of_spades","8_of_spades","9_of_spades","10_of_spades","jack_of_spades2","queen_of_spades2","king_of_spades2","ace_of_hearts","2_of_hearts","3_of_hearts","4_of_hearts","5_of_hearts","6_of_hearts","7_of_hearts","8_of_hearts","9_of_hearts","10_of_hearts","jack_of_hearts2","queen_of_hearts2","king_of_hearts2","ace_of_diamonds","2_of_diamonds","3_of_diamonds","4_of_diamonds","5_of_diamonds","6_of_diamonds","7_of_diamonds","8_of_diamonds","9_of_diamonds","10_of_diamonds","jack_of_diamonds2","queen_of_diamonds2","king_of_diamonds2","ace_of_clubs","2_of_clubs","3_of_clubs","4_of_clubs","5_of_clubs","6_of_clubs","7_of_clubs","8_of_clubs","9_of_clubs","10_of_clubs","jack_of_clubs2","queen_of_clubs2","king_of_clubs2","black_joker","red_joker"];class p extends o{constructor(){super(),this.name="Ace of Shadows",this.cards=[],this.speedMultiplier=p.DEFAULT_SPEED_MULTIPLIER,this.sourceStackCards=[],this.destinationStackCards=[],this.animationTimer=0,this.isAnimating=!1,this.animationComplete=!1,this.activeTween=null,this.animatingCard=null,this.sourceStackPosition={x:0,y:0},this.destinationStackPosition={x:0,y:0},this.titleText=new n.T7$("Ace of Shadows",{fontName:"MonospaceBold",fontSize:28}),this.tweenGroup=new d.YJ,this.container.sortableChildren=!0}init(){this.setupTitle(),this.createCards(),this.calculateStackPositions(),this.arrangeCards(),this.initialized=!0}setupTitle(){this.titleText.tint=s.WHITE,this.titleText.anchor.set(.5,0),this.titleText.x=this.screenWidth/2,this.titleText.y=40,this.container.addChild(this.titleText)}createCards(){for(let t=1;t<=p.TOTAL_CARDS;t++){const e=new u(t);e.setStackPosition(0,t-1),this.cards.push(e),this.sourceStackCards.push(e),this.container.addChild(e)}}calculateStackPositions(){this.sourceStackPosition.x=this.screenWidth/2-100,this.sourceStackPosition.y=this.screenHeight/2-200,this.destinationStackPosition.x=this.screenWidth/2+200,this.destinationStackPosition.y=this.screenHeight/2-200}arrangeCards(){this.arrangeStack(this.sourceStackCards,this.sourceStackPosition),this.arrangeStack(this.destinationStackCards,this.destinationStackPosition)}arrangeStack(t,e){for(let i=0;i<t.length;i++){const s=t[i];s&&(s.x=e.x+i*p.CARD_OFFSET_X,s.y=e.y+i*p.CARD_OFFSET_Y,s.zIndex=i)}}update(t){if(this.tweenGroup.update(),this.animationTimer+=t,this.sourceStackCards.length>0&&!this.isAnimating){const t=p.ANIMATION_INTERVAL/this.speedMultiplier;this.animationTimer>=t&&(this.animateNextCard(),this.animationTimer=0)}else 0!==this.sourceStackCards.length||this.isAnimating||this.animationComplete||(this.animationComplete=!0,this.onAllCardsTransferred())}onAllCardsTransferred(){console.log("All cards have been transferred to destination stack")}animateNextCard(){if(0===this.sourceStackCards.length||this.isAnimating)return;const t=this.sourceStackCards.pop();if(!t)return;this.isAnimating=!0,this.animatingCard=t;const e=this.destinationStackCards.length,i=this.destinationStackPosition.x+e*p.CARD_OFFSET_X,s=this.destinationStackPosition.y+e*p.CARD_OFFSET_Y;t.zIndex=1e3+e;const n=t.rotation,a=n+.2*(Math.random()-.5);this.activeTween=new d.K({x:t.x,y:t.y,rotation:n}).to({x:i,y:s,rotation:a},p.ANIMATION_DURATION/this.speedMultiplier).easing(d.GS.Sinusoidal.InOut).onUpdate(e=>{t.x=e.x,t.y=e.y,t.rotation=e.rotation}).onComplete(()=>{this.destinationStackCards.push(t),t.setStackPosition(1,e),t.zIndex=this.destinationStackCards.length-1,this.tweenGroup.add(new d.K({rotation:t.rotation}).to({rotation:0},500).easing(d.GS.Back.Out).onUpdate(e=>{t.rotation=e.rotation}).start()),this.isAnimating=!1,this.activeTween=null,this.animatingCard=null}).start(),this.tweenGroup.add(this.activeTween)}onResize(t,e){if(this.titleText.x=t/2,this.calculateStackPositions(),this.activeTween&&this.animatingCard){this.activeTween.stop();const t=this.destinationStackCards.length,e=this.destinationStackPosition.x+t*p.CARD_OFFSET_X,i=this.destinationStackPosition.y+t*p.CARD_OFFSET_Y,s=this.animatingCard,n=s.rotation;this.activeTween=new d.K({x:s.x,y:s.y,rotation:n}).to({x:e,y:i,rotation:n},p.ANIMATION_DURATION/this.speedMultiplier).easing(d.GS.Sinusoidal.InOut).onUpdate(t=>{s.x=t.x,s.y=t.y,s.rotation=t.rotation}).onComplete(()=>{this.destinationStackCards.push(s),s.setStackPosition(1,t),s.zIndex=this.destinationStackCards.length-1,this.tweenGroup.add(new d.K({rotation:s.rotation}).to({rotation:0},500).easing(d.GS.Back.Out).onUpdate(t=>{s.rotation=t.rotation}).start()),this.isAnimating=!1,this.activeTween=null,this.animatingCard=null}).start(),this.tweenGroup.add(this.activeTween)}this.arrangeCards()}setSpeedMultiplier(t){this.speedMultiplier=Math.max(.1,t)}getSpeedMultiplier(){return this.speedMultiplier}destroy(){this.activeTween&&(this.activeTween.stop(),this.activeTween=null),this.animatingCard=null,this.isAnimating=!1,this.tweenGroup.removeAll(),super.destroy()}}p.TOTAL_CARDS=144,p.CARD_OFFSET_X=1,p.CARD_OFFSET_Y=2.7,p.ANIMATION_INTERVAL=1e3,p.ANIMATION_DURATION=2e3,p.DEFAULT_SPEED_MULTIPLIER=1;class g extends n.mcf{constructor(t,e,i="MonospaceBold",s=20,n=g.MAX_WIDTH){super(),this.text=t,this.fontName=i,this.fontSize=s,this.maxWidth=n,this.textSegments=[],this.emojiTextures=new Map,this.displayObjects=[],this.emojiTextures=e,this.spaceWidth=this.measureTextWidth("  "),this.parseAndLayoutText(),this.createDisplayObjects()}parseAndLayoutText(){this.textSegments=[];const t=/\{([^}]+)\}/g,e=[];let i,s=0;for(;null!==(i=t.exec(this.text));)i.index>s&&e.push({type:"text",content:this.text.slice(s,i.index)}),e.push({type:"emoji",content:i[1]??""}),s=i.index+i[0].length;s<this.text.length&&e.push({type:"text",content:this.text.slice(s)}),this.layoutParts(e)}layoutParts(t){let e=0,i=0;const s=g.LINE_HEIGHT;for(const n of t)if("text"===n.type&&n.content){const t=n.content.split(" ");for(let n=0;n<t.length;n++){const a=t[n];if(!a)continue;const o=n<t.length-1?a+" ":a,r=this.measureTextWidth(o);e+r>this.maxWidth&&e>0&&(e=0,i+=s),this.textSegments.push({type:"text",content:o,x:e,y:i,width:r}),e+=r+this.spaceWidth}}else if("emoji"===n.type){const t=g.EMOJI_SIZE;e+t>this.maxWidth&&e>0&&(e=0,i+=s),this.textSegments.push({type:"emoji",content:n.content,x:e,y:i,width:t}),e+=t+this.spaceWidth}}measureTextWidth(t){const e=new n.T7$(t,{fontName:this.fontName,fontSize:this.fontSize}),i=e.width;return e.destroy(),i}createDisplayObjects(){this.clearDisplayObjects();for(const t of this.textSegments)if("text"===t.type){const e=new n.T7$(t.content,{fontName:this.fontName,fontSize:this.fontSize});e.x=t.x,e.y=t.y,this.addChild(e),this.displayObjects.push(e)}else{const e=this.emojiTextures.get(t.content);if(e){const i=new n.kxk(e);i.x=t.x,i.y=t.y,i.width=g.EMOJI_SIZE,i.height=g.EMOJI_SIZE,this.addChild(i),this.displayObjects.push(i)}}}clearDisplayObjects(){for(const t of this.displayObjects)this.removeChild(t),t.destroy();this.displayObjects=[]}updateText(t){this.text=t,this.parseAndLayoutText(),this.createDisplayObjects()}updateMaxWidth(t){this.maxWidth=t,this.parseAndLayoutText(),this.createDisplayObjects()}getContentHeight(){return 0===this.textSegments.length?0:Math.max(...this.textSegments.map(t=>t.y))+g.LINE_HEIGHT}destroy(){this.clearDisplayObjects(),super.destroy({children:!0})}}g.EMOJI_SIZE=24,g.LINE_HEIGHT=32,g.MAX_WIDTH=600;class m extends n.mcf{constructor(t,e,i){super(),this.dialogueEntries=[],this.emojiTextures=new Map,this.avatarTextures=new Map,this.currentDialogueIndex=0,this.screenWidth=0,this.screenHeight=0,this.currentTextComponent=null,this.currentAvatarSprite=null,this.currentAvatarName=null,this.isReady=!1,this.dialogueEntries=t,this.emojiTextures=e,this.avatarTextures=i,this.createDialogueBox(),this.isReady=!0,this.displayCurrentDialogue()}createDialogueBox(){this.dialogueBox=new n.A1g,this.dialogueBox.beginFill(s.BLACK,.8),this.dialogueBox.lineStyle(2,s.WHITE,1),this.dialogueBox.drawRoundedRect(0,0,100,100,10),this.dialogueBox.endFill(),this.addChild(this.dialogueBox)}displayCurrentDialogue(){if(!this.isReady||this.currentDialogueIndex>=this.dialogueEntries.length)return;const t=this.dialogueEntries[this.currentDialogueIndex];if(!t)return;const e=t.name;this.clearCurrentDisplay(),this.updateDialogueBox(),this.displayAvatar(e),this.displayText(t.text,"left")}clearCurrentDisplay(){this.currentTextComponent&&(this.removeChild(this.currentTextComponent),this.currentTextComponent.destroy(),this.currentTextComponent=null),this.currentAvatarSprite&&(this.removeChild(this.currentAvatarSprite),this.currentAvatarSprite.destroy(),this.currentAvatarSprite=null),this.currentAvatarName&&(this.removeChild(this.currentAvatarName),this.currentAvatarName.destroy(),this.currentAvatarName=null)}getDialogueBoxWidth(){return this.screenWidth-40}updateDialogueBox(){const t=this.getDialogueBoxWidth(),e=m.DIALOGUE_BOX_HEIGHT,i=this.screenHeight-e-20;this.dialogueBox.clear(),this.dialogueBox.beginFill(s.BLACK,.8),this.dialogueBox.lineStyle(2,s.WHITE,1),this.dialogueBox.drawRoundedRect(20,i,t,e,10),this.dialogueBox.endFill()}displayAvatar(t){const e=this.screenHeight-m.DIALOGUE_BOX_HEIGHT-20,i=this.avatarTextures.get(t)??{texture:r.getTexture("default_avatar"),position:"left"},a="left"===i.position?m.AVATAR_MARGIN:this.getDialogueBoxWidth()-m.AVATAR_MARGIN-m.AVATAR_SIZE/2;this.currentAvatarName=new n.T7$(t,{fontName:"MonospaceBold",fontSize:14}),this.currentAvatarName.tint=s.WHITE,this.currentAvatarName.anchor.set(.5),this.currentAvatarName.x=a+m.AVATAR_SIZE/2,this.currentAvatarName.y=e-10,this.addChild(this.currentAvatarName),this.currentAvatarSprite=new n.kxk(i.texture),this.currentAvatarSprite.width=m.AVATAR_SIZE,this.currentAvatarSprite.height=m.AVATAR_SIZE,this.currentAvatarSprite.x=a,this.currentAvatarSprite.y=e-m.AVATAR_SIZE-20,this.addChild(this.currentAvatarSprite)}displayText(t,e){const i=this.screenWidth-40-2*m.DIALOGUE_BOX_PADDING-m.AVATAR_SIZE-m.AVATAR_MARGIN;this.currentTextComponent=new g(t,this.emojiTextures,"MonospaceBold",18,i);const s=this.screenHeight-m.DIALOGUE_BOX_HEIGHT-20;this.currentTextComponent.x=20+m.DIALOGUE_BOX_PADDING,this.currentTextComponent.y=s+m.DIALOGUE_BOX_PADDING,this.addChild(this.currentTextComponent)}nextDialogue(){return this.currentDialogueIndex<this.dialogueEntries.length-1&&(this.currentDialogueIndex++,this.displayCurrentDialogue(),!0)}previousDialogue(){return this.currentDialogueIndex>0&&(this.currentDialogueIndex--,this.displayCurrentDialogue(),!0)}getCurrentDialogueIndex(){return this.currentDialogueIndex}getTotalDialogues(){return this.dialogueEntries.length}isAtEnd(){return this.currentDialogueIndex>=this.dialogueEntries.length-1}isAtStart(){return this.currentDialogueIndex<=0}resetToStart(){this.currentDialogueIndex=0,this.displayCurrentDialogue()}resize(t,e){this.screenWidth=t,this.screenHeight=e,this.isReady&&this.displayCurrentDialogue()}destroy(){this.clearCurrentDisplay(),super.destroy({children:!0})}}m.AVATAR_SIZE=80,m.DIALOGUE_BOX_HEIGHT=120,m.DIALOGUE_BOX_PADDING=20,m.AVATAR_MARGIN=20;class f extends o{constructor(){super(),this.name="Magic Words",this.dialogueComponent=null,this.magicWordsData=null,this.hasError=!1,this.clickArea=new n.mcf,this.setupClickArea()}setupClickArea(){this.clickArea.hitArea=new n.M_G(0,0,100,100),this.clickArea.eventMode="static",this.clickArea.cursor="pointer",this.clickArea.on("pointertap",this.onScreenClick.bind(this))}init(){this.createBitmapTexts(),this.setupTitle();try{if(this.magicWordsData=r.getMagicWordsData(),!this.magicWordsData)throw new Error("Magic Words data not loaded by AssetLoader");this.createDialogueComponent(),this.setupUI()}catch(t){this.handleLoadError(t)}this.initialized=!0}createBitmapTexts(){this.titleText=new n.T7$("Magic Words",{fontName:"MonospaceBold",fontSize:28}),this.instructionText=new n.T7$("Click anywhere to continue dialogue",{fontName:"MonospaceBold",fontSize:16}),this.progressText=new n.T7$("",{fontName:"MonospaceBold",fontSize:14})}setupTitle(){this.titleText.tint=s.WHITE,this.titleText.anchor.set(.5,0),this.titleText.x=this.screenWidth/2,this.titleText.y=40,this.container.addChild(this.titleText)}createDialogueComponent(){if(!this.magicWordsData)return;const t=r.getAllEmojiTextures(),e=r.getAllAvatarTextures();this.dialogueComponent=new m(this.magicWordsData.dialogue,t,e),this.dialogueComponent.resize(this.screenWidth,this.screenHeight),this.container.addChild(this.dialogueComponent)}setupUI(){this.instructionText.tint=s.WHITE,this.instructionText.anchor.set(.5),this.instructionText.x=this.screenWidth/2,this.instructionText.y=80,this.container.addChild(this.instructionText),this.progressText.tint=s.WHITE,this.progressText.anchor.set(.5),this.progressText.x=this.screenWidth/2,this.progressText.y=110,this.container.addChild(this.progressText),this.container.addChild(this.clickArea),this.updateProgressText()}handleLoadError(t){console.error("Failed to load Magic Words data:",t),this.hasError=!0;const e=new n.T7$("Failed to load dialogue data.\nCheck console for details.",{fontName:"MonospaceBold",fontSize:16});e.tint=s.WHITE,e.anchor.set(.5),e.x=this.screenWidth/2,e.y=this.screenHeight/2,this.container.addChild(e)}onScreenClick(){if(this.hasError||!this.dialogueComponent)return;const t=this.dialogueComponent.nextDialogue();this.updateProgressText(),t||this.onDialogueComplete()}updateProgressText(){if(!this.dialogueComponent)return;const t=this.dialogueComponent.getCurrentDialogueIndex()+1,e=this.dialogueComponent.getTotalDialogues();this.progressText.text=`Dialogue ${t.toString()} / ${e.toString()}`}onDialogueComplete(){this.instructionText.text="All dialogues complete! Click to restart.",this.clickArea.removeAllListeners("pointertap"),this.clickArea.on("pointertap",()=>{this.dialogueComponent&&(this.dialogueComponent.resetToStart(),this.updateProgressText(),this.instructionText.text="Click anywhere to continue dialogue",this.clickArea.removeAllListeners("pointertap"),this.clickArea.on("pointertap",this.onScreenClick.bind(this)))})}update(t){}onResize(t,e){this.titleText.x=t/2,this.instructionText.x=t/2,this.progressText.x=t/2,this.dialogueComponent&&this.dialogueComponent.resize(t,e),this.clickArea.hitArea=new n.M_G(0,0,t,e)}getSpriteCount(){let t=3;return this.dialogueComponent&&(t+=10),t}destroy(){this.clickArea.removeAllListeners(),this.dialogueComponent&&this.dialogueComponent.destroy(),super.destroy()}}class x{constructor(t){this.POS_Y=140,this.POS_X=10,this.PADDING_X=10,this.BUTTON_WIDTH=100,this.BUTTON_HEIGHT=30,this.gameManager=t,this.container=new n.mcf,this.background=new n.A1g,this.fullscreenButton=new n.mcf,this.debugToggleButton=new n.mcf,this.phoenixFlameButton=new n.mcf,this.aceOfShadowsButton=new n.mcf,this.magicWordsButton=new n.mcf}init(){this.setupBackground(),this.setupCurrentSceneText(),this.setupSceneButtons(),this.setupFullscreenButton(),this.setupDebugToggleButton(),this.setupLayout()}setupBackground(){this.background.beginFill(0,.7),this.background.lineStyle(1,s.BLUE,1),this.background.drawRoundedRect(0,0,340,160,5),this.background.endFill(),this.container.addChild(this.background)}setupCurrentSceneText(){this.currentSceneText=new n.T7$("Current: Demo",{fontName:"MonospaceBold",fontSize:16}),this.currentSceneText.tint=s.WHITE,this.container.addChild(this.currentSceneText)}setupSceneButtons(){this.createSceneButton(this.aceOfShadowsButton,"Ace of Shadows",()=>{this.gameManager.switchToScene(new p)}),this.createSceneButton(this.magicWordsButton,"Magic Words",()=>{this.gameManager.switchToScene(new f)}),this.createSceneButton(this.phoenixFlameButton,"Phoenix Flame",()=>{this.gameManager.switchToScene(new l)}),this.container.addChild(this.phoenixFlameButton),this.container.addChild(this.aceOfShadowsButton),this.container.addChild(this.magicWordsButton)}createSceneButton(t,e,i){const a=new n.A1g;a.beginFill(s.DARK_GRAY),a.lineStyle(1,s.YELLOW),a.drawRoundedRect(0,0,this.BUTTON_WIDTH,this.BUTTON_HEIGHT,3),a.endFill();const o=new n.T7$(e,{fontName:"MonospaceBold",fontSize:12});o.tint=s.YELLOW,o.position.set((this.BUTTON_WIDTH-o.width)/2,(this.BUTTON_HEIGHT-o.height)/2),t.addChild(a),t.addChild(o),t.eventMode="static",t.cursor="pointer",t.on("pointerdown",i),t.on("click",i),t.on("pointerover",()=>{a.tint=13421772}),t.on("pointerout",()=>{a.tint=16777215}),t.on("touchstart",()=>{a.tint=13421772}),t.on("touchend",()=>{a.tint=16777215})}setupFullscreenButton(){const t=new n.A1g;t.beginFill(s.DARK_GRAY),t.lineStyle(1,s.WHITE),t.drawRoundedRect(0,0,this.BUTTON_WIDTH,this.BUTTON_HEIGHT,3),t.endFill();const e=new n.T7$("Fullscreen",{fontName:"MonospaceBold",fontSize:14});e.tint=s.WHITE,e.position.set((this.BUTTON_WIDTH-e.width)/2,(this.BUTTON_HEIGHT-e.height)/2),this.fullscreenButton.addChild(t),this.fullscreenButton.addChild(e),this.fullscreenButton.eventMode="static",this.fullscreenButton.cursor="pointer";const i=()=>{this.gameManager.toggleFullscreen()};this.fullscreenButton.on("pointerdown",i),this.fullscreenButton.on("click",i),this.fullscreenButton.on("pointerover",()=>{t.tint=13421772}),this.fullscreenButton.on("pointerout",()=>{t.tint=16777215}),this.fullscreenButton.on("touchstart",()=>{t.tint=13421772}),this.fullscreenButton.on("touchend",()=>{t.tint=16777215}),this.container.addChild(this.fullscreenButton)}setupDebugToggleButton(){const t=new n.A1g;t.beginFill(s.DARK_GRAY),t.lineStyle(1,s.DEBUG_GREEN),t.drawRoundedRect(0,0,this.BUTTON_WIDTH,this.BUTTON_HEIGHT,3),t.endFill();const e=new n.T7$("Debug: ON",{fontName:"MonospaceBold",fontSize:14});e.tint=s.DEBUG_GREEN,e.position.set((this.BUTTON_WIDTH-e.width)/2,(this.BUTTON_HEIGHT-e.height)/2),this.debugToggleButton.addChild(t),this.debugToggleButton.addChild(e),this.debugToggleButton.eventMode="static",this.debugToggleButton.cursor="pointer";const i=()=>{this.gameManager.toggleDebugMode();const t=this.gameManager.debugMode?"Debug: ON":"Debug: OFF";e.text=t,e.tint=this.gameManager.debugMode?s.DEBUG_GREEN:s.RED,e.position.set((this.BUTTON_WIDTH-e.width)/2,(this.BUTTON_HEIGHT-e.height)/2)};this.debugToggleButton.on("pointerdown",i),this.debugToggleButton.on("click",i),this.debugToggleButton.on("pointerover",()=>{t.tint=13421772}),this.debugToggleButton.on("pointerout",()=>{t.tint=16777215}),this.debugToggleButton.on("touchstart",()=>{t.tint=13421772}),this.debugToggleButton.on("touchend",()=>{t.tint=16777215}),this.container.addChild(this.debugToggleButton)}setupLayout(){this.container.position.set(this.POS_X,this.POS_Y),this.currentSceneText.position.set(this.PADDING_X,10),this.aceOfShadowsButton.position.set(this.PADDING_X,40),this.magicWordsButton.position.set(this.PADDING_X+this.BUTTON_WIDTH+5,40),this.phoenixFlameButton.position.set(this.PADDING_X+2*(this.BUTTON_WIDTH+5),40),this.fullscreenButton.position.set(this.PADDING_X,90),this.debugToggleButton.position.set(this.PADDING_X+this.BUTTON_WIDTH+5,90)}updateCurrentScene(t){this.currentSceneText.text=`Current: ${t}`}}class _{constructor(t,e){this.currentScene=null,this.debugMode=!0,this.app=t,this.config=e,this.assetLoader=new r,this.debugMenu=new a,this.sceneControls=new x(this),this.app.currentScene=null,this.app.debugMode=this.debugMode}async init(){try{await this.assetLoader.loadInitialAssets(),this.setupUI(),this.setupGameLoop(),this.switchToScene(new p)}catch(t){throw console.error("GameManager initialization failed:",t),t}}setupUI(){this.app.stage.addChild(this.debugMenu.container),this.app.stage.addChild(this.sceneControls.container),this.debugMenu.init(),this.sceneControls.init()}setupGameLoop(){this.app.ticker.add(()=>{this.currentScene&&this.currentScene.update(this.app.ticker.deltaMS),this.debugMode&&this.updateDebugInfo(this.app.ticker)})}updateDebugInfo(t){const e={fps:Math.round(10*t.FPS)/10,sceneName:this.currentScene?.name??"No Scene",spriteCount:this.getSpriteCount()};this.debugMenu.updateDebugInfo(e)}getSpriteCount(){if(!this.currentScene)return 0;let t=0;const e=i=>{for(const s of i.children)"texture"in s&&s.texture&&t++,s instanceof n.mcf&&s.children.length>0&&e(s)};return e(this.currentScene.container),t}switchToScene(t){try{this.currentScene&&(this.app.stage.removeChild(this.currentScene.container),this.currentScene.destroy()),this.currentScene=t,this.app.currentScene=t,this.app.stage.addChildAt(t.container,0),t.init(),t.resize(this.app.screen.width,this.app.screen.height),this.sceneControls.updateCurrentScene(t.name)}catch(t){throw console.error("Failed to switch scene:",t),t}}handleResize(){const t=this.app.view,e=t.parentElement;if(!e)return;const i=e.clientWidth,s=e.clientHeight;t.style.transform="",t.style.transformOrigin="";const n=this.config.height,a=i/s,o=Math.ceil(n*a);this.app.renderer.resize(o,n),t.style.width=`${i}px`,t.style.height=`${s}px`,this.currentScene&&this.currentScene.resize(o,n)}toggleFullscreen(){document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen().catch(t=>{console.error("Error attempting to enable fullscreen:",t)})}toggleDebugMode(){this.debugMode=!this.debugMode,this.app.debugMode=this.debugMode,this.debugMenu.setVisible(this.debugMode)}}const T={width:1024,height:768,backgroundColor:s.BACKGROUND,antialias:!0,resolution:window.devicePixelRatio||1};async function A(){try{const t=new n.lgM({width:T.width,height:T.height,backgroundColor:T.backgroundColor,antialias:T.antialias,resolution:T.resolution,autoDensity:!0}),e=document.getElementById("gameContainer");if(!e)throw new Error("Game container element not found");e.appendChild(t.view);const i=new _(t,T);await i.init(),window.addEventListener("resize",()=>{i.handleResize()}),i.handleResize()}catch(t){console.error("Failed to initialize game:",t);const e=document.createElement("div");e.style.color="white",e.style.fontSize="24px",e.style.textAlign="center",e.style.margin="50px",e.textContent=`Game initialization failed: ${t instanceof Error?t.message:String(t)}`;const i=document.getElementById("gameContainer");i&&i.appendChild(e)}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{A()}):A()}},i={};function s(t){var n=i[t];if(void 0!==n)return n.exports;var a=i[t]={id:t,loaded:!1,exports:{}};return e[t].call(a.exports,a,a.exports,s),a.loaded=!0,a.exports}s.m=e,t=[],s.O=(e,i,n,a)=>{if(!i){var o=1/0;for(l=0;l<t.length;l++){for(var[i,n,a]=t[l],r=!0,h=0;h<i.length;h++)(!1&a||o>=a)&&Object.keys(s.O).every(t=>s.O[t](i[h]))?i.splice(h--,1):(r=!1,a<o&&(o=a));if(r){t.splice(l--,1);var c=n();void 0!==c&&(e=c)}}return e}a=a||0;for(var l=t.length;l>0&&t[l-1][2]>a;l--)t[l]=t[l-1];t[l]=[i,n,a]},s.d=(t,e)=>{for(var i in e)s.o(e,i)&&!s.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),s.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),(()=>{var t={792:0};s.O.j=e=>0===t[e];var e=(e,i)=>{var n,a,[o,r,h]=i,c=0;if(o.some(e=>0!==t[e])){for(n in r)s.o(r,n)&&(s.m[n]=r[n]);if(h)var l=h(s)}for(e&&e(i);c<o.length;c++)a=o[c],s.o(t,a)&&t[a]&&t[a][0](),t[a]=0;return s.O(l)},i=self.webpackChunkpixi7_game_demo=self.webpackChunkpixi7_game_demo||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})();var n=s.O(void 0,[96],()=>s(6948));n=s.O(n)})();
//# sourceMappingURL=main.69e6df7799b0a5ecc5c7.js.map